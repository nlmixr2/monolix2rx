<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulate Derived Variables from imported Monolix model • monolix2rx</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate Derived Variables from imported Monolix model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">monolix2rx</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/convert-nlmixr2.html"><span class="fa fa-arrow-right"></span> Converting</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/rxode2-validate.html"><span class="fa fa-check"></span> Qualify</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-simulation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-dice"></span> Simulation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-simulation">
<li><a class="dropdown-item" href="../articles/simulate-new-dosing.html">New Dosing Scenarios</a></li>
    <li><a class="dropdown-item" href="../articles/simulate-uncertainty.html">Simulating with Uncertainty</a></li>
    <li><a class="dropdown-item" href="../articles/simulate-extra-items.html">Simulating with Derived Variables</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reporting" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reporting</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reporting">
<li><a class="dropdown-item" href="../articles/create-office.html">Creating word and powerpoint documents</a></li>
    <li><a class="dropdown-item" href="../articles/create-vpc.html">Easily create VPC plots</a></li>
    <li><a class="dropdown-item" href="../articles/create-augPred.html">Create enriched Individual plots</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fas fa-rss"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nlmixr2/monolix2rx/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Simulate Derived Variables from imported Monolix model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nlmixr2/monolix2rx/blob/main/vignettes/articles/simulate-extra-items.Rmd" class="external-link"><code>vignettes/articles/simulate-extra-items.Rmd</code></a></small>
      <div class="d-none name"><code>simulate-extra-items.Rmd</code></div>
    </div>

    
    
<p>This page shows a simple work-flow for directly simulating a
different dosing paradigm with new derived items, in this case
<code>AUC</code>.</p>
<div class="section level2">
<h2 id="step-1-import-the-model">Step 1: Import the model<a class="anchor" aria-label="anchor" href="#step-1-import-the-model"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.github.io/monolix2rx/" class="external-link">monolix2rx</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.github.io/rxode2/" class="external-link">rxode2</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># First we need the location of the nonmem control stream Since we are running an example, we will use one of the built-in examples in `nonmem2rx`</span></span>
<span><span class="va">ctlFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"mods/cpt/runODE032.ctl"</span>, package<span class="op">=</span><span class="st">"nonmem2rx"</span><span class="op">)</span></span>
<span><span class="co"># You can use a control stream or other file. With the development</span></span>
<span><span class="co"># version of `babelmixr2`, you can simply point to the listing file</span></span>
<span></span>
<span><span class="co"># You use the path to the monolix mlxtran file</span></span>
<span></span>
<span><span class="co"># In this case we will us the theophylline project included in monolix2rx</span></span>
<span><span class="va">pkgTheo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"theo/theophylline_project.mlxtran"</span>, package<span class="op">=</span><span class="st">"monolix2rx"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note you have to setup monolix2rx to use the model library or save</span></span>
<span><span class="co"># the model as a separate file</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/monolix2rx.html">monolix2rx</a></span><span class="op">(</span><span class="va">pkgTheo</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> integrated model file 'oral1_1cpt_kaVCl.txt' into mlxtran object</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> updating model values to final parameter estimates</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> reading run info (# obs, doses, Monolix Version, etc) from summary.txt</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> reading covariance from FisherInformation/covarianceEstimatesLin.txt</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; Warning in .dataRenameFromMlxtran(data, .mlxtran): NAs introduced by coercion</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> imported monolix and translated to rxode2 compatible data (<span style="color: #0000BB; font-weight: bold;">$monolixData</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> imported monolix ETAS (_SAEM) imported to rxode2 compatible data (<span style="color: #0000BB; font-weight: bold;">$etaData</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> imported monolix pred/ipred data to compare (<span style="color: #0000BB; font-weight: bold;">$predIpredData</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> solving ipred problem</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> solving pred problem</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;  <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">rxode2-based free-form 2-cmt ODE model</span> <span style="color: #00BBBB;">──────────────────────────────────────</span> </span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">Initalization:</span> ──  </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Fixed Effects</span> (<span style="color: #0000BB; font-weight: bold;">$theta</span>): </span></span>
<span><span class="co">#&gt;      ka_pop       V_pop      Cl_pop           a           b </span></span>
<span><span class="co">#&gt;  0.42699448 -0.78635157 -3.21457598  0.43327956  0.05425953 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Omega</span> (<span style="color: #0000BB; font-weight: bold;">$omega</span>): </span></span>
<span><span class="co">#&gt;           omega_ka    omega_V   omega_Cl</span></span>
<span><span class="co">#&gt; omega_ka 0.4503145 0.00000000 0.00000000</span></span>
<span><span class="co">#&gt; omega_V  0.0000000 0.01594701 0.00000000</span></span>
<span><span class="co">#&gt; omega_Cl 0.0000000 0.00000000 0.07323701</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; States</span> (<span style="color: #0000BB; font-weight: bold;">$state</span> or <span style="color: #0000BB; font-weight: bold;">$stateDf</span>): </span></span>
<span><span class="co">#&gt;   Compartment Number Compartment Name</span></span>
<span><span class="co">#&gt; 1                  1            depot</span></span>
<span><span class="co">#&gt; 2                  2          central</span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">μ-referencing (</span><span style="color: #0000BB; font-weight: bold;">$muRefTable</span><span style="font-weight: bold;">):</span> ──  </span></span>
<span><span class="co">#&gt;    theta      eta level</span></span>
<span><span class="co">#&gt; 1 ka_pop omega_ka    id</span></span>
<span><span class="co">#&gt; 2  V_pop  omega_V    id</span></span>
<span><span class="co">#&gt; 3 Cl_pop omega_Cl    id</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">Model (Normalized Syntax):</span> ── </span></span>
<span><span class="co">#&gt; function() {</span></span>
<span><span class="co">#&gt;     description &lt;- "The administration is extravascular with a first order absorption (rate constant ka).\nThe PK model has one compartment (volume V) and a linear elimination (clearance Cl).\nThis has been modified so that it will run without the model library"</span></span>
<span><span class="co">#&gt;     dfObs &lt;- 120</span></span>
<span><span class="co">#&gt;     dfSub &lt;- 12</span></span>
<span><span class="co">#&gt;     thetaMat &lt;- lotri({</span></span>
<span><span class="co">#&gt;         ka_pop ~ 0.09785</span></span>
<span><span class="co">#&gt;         V_pop ~ c(0.00082606, 0.00041937)</span></span>
<span><span class="co">#&gt;         Cl_pop ~ c(-4.2833e-05, -6.7957e-06, 1.1318e-05)</span></span>
<span><span class="co">#&gt;         omega_ka ~ c(omega_ka = 0.022259)</span></span>
<span><span class="co">#&gt;         omega_V ~ c(omega_ka = -7.6443e-05, omega_V = 0.0014578)</span></span>
<span><span class="co">#&gt;         omega_Cl ~ c(omega_ka = 3.062e-06, omega_V = -1.2912e-05, </span></span>
<span><span class="co">#&gt;             omega_Cl = 0.0039578)</span></span>
<span><span class="co">#&gt;         a ~ c(omega_ka = -0.0001227, omega_V = -6.5914e-05, omega_Cl = -0.00041194, </span></span>
<span><span class="co">#&gt;             a = 0.015333)</span></span>
<span><span class="co">#&gt;         b ~ c(omega_ka = -1.3886e-05, omega_V = -3.1105e-05, </span></span>
<span><span class="co">#&gt;             omega_Cl = 5.2805e-05, a = -0.0026458, b = 0.00056232)</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     validation &lt;- c("ipred relative difference compared to Monolix ipred: 0.04%; 95% percentile: (0%,0.52%); rtol=0.00038", </span></span>
<span><span class="co">#&gt;         "ipred absolute difference compared to Monolix ipred: 95% percentile: (0.000362, 0.00848); atol=0.00254", </span></span>
<span><span class="co">#&gt;         "pred relative difference compared to Monolix pred: 0%; 95% percentile: (0%,0%); rtol=6.6e-07", </span></span>
<span><span class="co">#&gt;         "pred absolute difference compared to Monolix pred: 95% percentile: (1.6e-07, 1.27e-05); atol=3.66e-06", </span></span>
<span><span class="co">#&gt;         "iwres relative difference compared to Monolix iwres: 0%; 95% percentile: (0.06%,32.22%); rtol=0.0153", </span></span>
<span><span class="co">#&gt;         "iwres absolute difference compared to Monolix pred: 95% percentile: (0.000403, 0.0138); atol=0.00305")</span></span>
<span><span class="co">#&gt;     ini({</span></span>
<span><span class="co">#&gt;         ka_pop &lt;- 0.426994483535611</span></span>
<span><span class="co">#&gt;         V_pop &lt;- -0.786351566327091</span></span>
<span><span class="co">#&gt;         Cl_pop &lt;- -3.21457597916301</span></span>
<span><span class="co">#&gt;         a &lt;- c(0, 0.433279557549051)</span></span>
<span><span class="co">#&gt;         b &lt;- c(0, 0.0542595276206251)</span></span>
<span><span class="co">#&gt;         omega_ka ~ 0.450314511978718</span></span>
<span><span class="co">#&gt;         omega_V ~ 0.0159470121255372</span></span>
<span><span class="co">#&gt;         omega_Cl ~ 0.0732370098834837</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     model({</span></span>
<span><span class="co">#&gt;         cmt(depot)</span></span>
<span><span class="co">#&gt;         cmt(central)</span></span>
<span><span class="co">#&gt;         ka &lt;- exp(ka_pop + omega_ka)</span></span>
<span><span class="co">#&gt;         V &lt;- exp(V_pop + omega_V)</span></span>
<span><span class="co">#&gt;         Cl &lt;- exp(Cl_pop + omega_Cl)</span></span>
<span><span class="co">#&gt;         d/dt(depot) &lt;- -ka * depot</span></span>
<span><span class="co">#&gt;         d/dt(central) &lt;- +ka * depot - Cl/V * central</span></span>
<span><span class="co">#&gt;         Cc &lt;- central/V</span></span>
<span><span class="co">#&gt;         CONC &lt;- Cc</span></span>
<span><span class="co">#&gt;         CONC ~ add(a) + prop(b) + combined1()</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-2-add-auc-calculation">Step 2: Add AUC calculation<a class="anchor" aria-label="anchor" href="#step-2-add-auc-calculation"></a>
</h2>
<p>The concentration in this case is the <code>Cc</code> from the model,
a trick to get the <code>AUC</code> is to have an additional ODE
<code>d/dt(AUC) &lt;- Cc</code> and use some reset to get it per dosing
period.</p>
<p>However, this additional parameter is not part of the original model.
The calculation of AUC would depend on the number of observations in
your model, and for sparse data wouldn’t be terribly accurate.</p>
<p>One thing you can do is to use model piping append
<code>d/dt(AUC) &lt;- Cc</code> to the imported model:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modAuc</span> <span class="op">&lt;-</span> <span class="va">mod</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">AUC</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Cc</span>, append<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; → significant model change detected</span></span>
<span><span class="co">#&gt; → kept in model: '$monolixData'</span></span>
<span><span class="co">#&gt; → removed from model: '$admd', '$etaData', '$ipredAtol', '$ipredCompare', '$ipredRtol', '$iwresAtol', '$iwresCompare', '$iwresRtol', '$mlxtran', '$predAtol', '$predCompare', '$predIpredData', '$predRtol'</span></span>
<span></span>
<span><span class="va">modAuc</span></span>
<span><span class="co">#&gt;  <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">rxode2-based free-form 3-cmt ODE model</span> <span style="color: #00BBBB;">──────────────────────────────────────</span> </span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">Initalization:</span> ──  </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Fixed Effects</span> (<span style="color: #0000BB; font-weight: bold;">$theta</span>): </span></span>
<span><span class="co">#&gt;      ka_pop       V_pop      Cl_pop           a           b </span></span>
<span><span class="co">#&gt;  0.42699448 -0.78635157 -3.21457598  0.43327956  0.05425953 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Omega</span> (<span style="color: #0000BB; font-weight: bold;">$omega</span>): </span></span>
<span><span class="co">#&gt;           omega_ka    omega_V   omega_Cl</span></span>
<span><span class="co">#&gt; omega_ka 0.4503145 0.00000000 0.00000000</span></span>
<span><span class="co">#&gt; omega_V  0.0000000 0.01594701 0.00000000</span></span>
<span><span class="co">#&gt; omega_Cl 0.0000000 0.00000000 0.07323701</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; States</span> (<span style="color: #0000BB; font-weight: bold;">$state</span> or <span style="color: #0000BB; font-weight: bold;">$stateDf</span>): </span></span>
<span><span class="co">#&gt;   Compartment Number Compartment Name</span></span>
<span><span class="co">#&gt; 1                  1            depot</span></span>
<span><span class="co">#&gt; 2                  2          central</span></span>
<span><span class="co">#&gt; 3                  3              AUC</span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">μ-referencing (</span><span style="color: #0000BB; font-weight: bold;">$muRefTable</span><span style="font-weight: bold;">):</span> ──  </span></span>
<span><span class="co">#&gt;    theta      eta level</span></span>
<span><span class="co">#&gt; 1 ka_pop omega_ka    id</span></span>
<span><span class="co">#&gt; 2  V_pop  omega_V    id</span></span>
<span><span class="co">#&gt; 3 Cl_pop omega_Cl    id</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">Model (Normalized Syntax):</span> ── </span></span>
<span><span class="co">#&gt; function() {</span></span>
<span><span class="co">#&gt;     description &lt;- "The administration is extravascular with a first order absorption (rate constant ka).\nThe PK model has one compartment (volume V) and a linear elimination (clearance Cl).\nThis has been modified so that it will run without the model library"</span></span>
<span><span class="co">#&gt;     dfObs &lt;- 120</span></span>
<span><span class="co">#&gt;     dfSub &lt;- 12</span></span>
<span><span class="co">#&gt;     thetaMat &lt;- lotri({</span></span>
<span><span class="co">#&gt;         ka_pop ~ 0.09785</span></span>
<span><span class="co">#&gt;         V_pop ~ c(0.00082606, 0.00041937)</span></span>
<span><span class="co">#&gt;         Cl_pop ~ c(-4.2833e-05, -6.7957e-06, 1.1318e-05)</span></span>
<span><span class="co">#&gt;         omega_ka ~ c(omega_ka = 0.022259)</span></span>
<span><span class="co">#&gt;         omega_V ~ c(omega_ka = -7.6443e-05, omega_V = 0.0014578)</span></span>
<span><span class="co">#&gt;         omega_Cl ~ c(omega_ka = 3.062e-06, omega_V = -1.2912e-05, </span></span>
<span><span class="co">#&gt;             omega_Cl = 0.0039578)</span></span>
<span><span class="co">#&gt;         a ~ c(omega_ka = -0.0001227, omega_V = -6.5914e-05, omega_Cl = -0.00041194, </span></span>
<span><span class="co">#&gt;             a = 0.015333)</span></span>
<span><span class="co">#&gt;         b ~ c(omega_ka = -1.3886e-05, omega_V = -3.1105e-05, </span></span>
<span><span class="co">#&gt;             omega_Cl = 5.2805e-05, a = -0.0026458, b = 0.00056232)</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     validation &lt;- c("ipred relative difference compared to Monolix ipred: 0.04%; 95% percentile: (0%,0.52%); rtol=0.00038", </span></span>
<span><span class="co">#&gt;         "ipred absolute difference compared to Monolix ipred: 95% percentile: (0.000362, 0.00848); atol=0.00254", </span></span>
<span><span class="co">#&gt;         "pred relative difference compared to Monolix pred: 0%; 95% percentile: (0%,0%); rtol=6.6e-07", </span></span>
<span><span class="co">#&gt;         "pred absolute difference compared to Monolix pred: 95% percentile: (1.6e-07, 1.27e-05); atol=3.66e-06", </span></span>
<span><span class="co">#&gt;         "iwres relative difference compared to Monolix iwres: 0%; 95% percentile: (0.06%,32.22%); rtol=0.0153", </span></span>
<span><span class="co">#&gt;         "iwres absolute difference compared to Monolix pred: 95% percentile: (0.000403, 0.0138); atol=0.00305")</span></span>
<span><span class="co">#&gt;     ini({</span></span>
<span><span class="co">#&gt;         ka_pop &lt;- 0.426994483535611</span></span>
<span><span class="co">#&gt;         V_pop &lt;- -0.786351566327091</span></span>
<span><span class="co">#&gt;         Cl_pop &lt;- -3.21457597916301</span></span>
<span><span class="co">#&gt;         a &lt;- c(0, 0.433279557549051)</span></span>
<span><span class="co">#&gt;         b &lt;- c(0, 0.0542595276206251)</span></span>
<span><span class="co">#&gt;         omega_ka ~ 0.450314511978718</span></span>
<span><span class="co">#&gt;         omega_V ~ 0.0159470121255372</span></span>
<span><span class="co">#&gt;         omega_Cl ~ 0.0732370098834837</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     model({</span></span>
<span><span class="co">#&gt;         cmt(depot)</span></span>
<span><span class="co">#&gt;         cmt(central)</span></span>
<span><span class="co">#&gt;         ka &lt;- exp(ka_pop + omega_ka)</span></span>
<span><span class="co">#&gt;         V &lt;- exp(V_pop + omega_V)</span></span>
<span><span class="co">#&gt;         Cl &lt;- exp(Cl_pop + omega_Cl)</span></span>
<span><span class="co">#&gt;         d/dt(depot) &lt;- -ka * depot</span></span>
<span><span class="co">#&gt;         d/dt(central) &lt;- +ka * depot - Cl/V * central</span></span>
<span><span class="co">#&gt;         Cc &lt;- central/V</span></span>
<span><span class="co">#&gt;         CONC &lt;- Cc</span></span>
<span><span class="co">#&gt;         CONC ~ add(a) + prop(b) + combined1()</span></span>
<span><span class="co">#&gt;         d/dt(AUC) &lt;- Cc</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>You can also use <code>append=NA</code> to pre-pend or
<code>append=f</code> to put the ODE right after the <code>f</code> line
in the model.</p>
</div>
<div class="section level2">
<h2 id="step-3-setup-event-table-to-calculate-the-auc-for-a-different-dosing-paradigm">Step 3: Setup event table to calculate the AUC for a different
dosing paradigm:<a class="anchor" aria-label="anchor" href="#step-3-setup-event-table-to-calculate-the-auc-for-a-different-dosing-paradigm"></a>
</h2>
<p>Lets say that in this case instead of a single dose, we want to see
what the concentration profile is with a single day of BID dosing. In
this case is done by creating a <a href="https://nlmixr2.github.io/rxode2/articles/rxode2-event-table.html" class="external-link">quick
event table</a>.</p>
<p>In this case since we are also wanting <code>AUC</code> per dosing
period, you can add a reset dose to the <code>AUC</code> compartment
every time a dose is given (so it will only track the AUC of the current
dose):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/et.html" class="external-link">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">4</span>, ii<span class="op">=</span><span class="fl">12</span>, until<span class="op">=</span><span class="fl">24</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/et.html" class="external-link">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">0</span>, ii<span class="op">=</span><span class="fl">12</span>, until<span class="op">=</span><span class="fl">24</span>, cmt<span class="op">=</span><span class="st">"AUC"</span>, evid<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># replace AUC with zero at dosing</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/et.html" class="external-link">et</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">11.999</span>, <span class="fl">12</span>, <span class="fl">12.01</span>, <span class="fl">14</span>, <span class="fl">20</span>, <span class="fl">23.999</span>, <span class="fl">24</span>, <span class="fl">24.001</span>, <span class="fl">28</span>, <span class="fl">32</span>, <span class="fl">36</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/et.html" class="external-link">et</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-4-solve-using-rxode2">Step 4: Solve using <code>rxode2</code><a class="anchor" aria-label="anchor" href="#step-4-solve-using-rxode2"></a>
</h2>
<p>In this step, we solve the model with the new event table for the 10
subjects:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSolve.html" class="external-link">rxSolve</a></span><span class="op">(</span><span class="va">modAuc</span>, <span class="va">ev</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using locf interpolation like Monolix, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using Monolix specified atol=1e-06</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using Monolix specified rtol=1e-06</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Since Monolix doesn't use ssRtol, set ssRtol=100</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Since Monolix doesn't use ssRtol, set ssAtol=100</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Since Monolix uses a set number of doses for steady state use maxSS=8, minSS=7</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0’</span></span></code></pre></div>
<p>Note that since this derived from a <code>nonmem2rx</code> model, the
default solving will match the tolerances and methods specified in your
<code>NONMEM</code> model.</p>
</div>
<div class="section level2">
<h2 id="step-5-exploring-the-simulation-by-plotting-and-summarizing-dplyr">Step 5: Exploring the simulation (by plotting), and summarizing
(dplyr)<a class="anchor" aria-label="anchor" href="#step-5-exploring-the-simulation-by-plotting-and-summarizing-dplyr"></a>
</h2>
<p>This solved object acts the same as any other <code>rxode2</code>
solved object, so you can use the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function to see
the individual running AUC profiles you simulated:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">AUC</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Running AUC"</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulate-extra-items_files/figure-html/plot-1.png" width="700"></p>
<p>You can also select the points near the dosing to get the AUC for the
interval:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:data.table':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     between, first, last</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="va">s</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11.999</span>,  <span class="fl">23.999</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">time</span>, <span class="va">AUC</span><span class="op">)</span></span>
<span><span class="co">#&gt;    id time       AUC</span></span>
<span><span class="co">#&gt; 1   1   12  71.67319</span></span>
<span><span class="co">#&gt; 2   1   24 102.46378</span></span>
<span><span class="co">#&gt; 3   2   12  62.73231</span></span>
<span><span class="co">#&gt; 4   2   24  91.10876</span></span>
<span><span class="co">#&gt; 5   3   12  62.42782</span></span>
<span><span class="co">#&gt; 6   3   24  86.37406</span></span>
<span><span class="co">#&gt; 7   4   12  44.99681</span></span>
<span><span class="co">#&gt; 8   4   24  59.71716</span></span>
<span><span class="co">#&gt; 9   5   12  58.29805</span></span>
<span><span class="co">#&gt; 10  5   24  81.99565</span></span>
<span><span class="co">#&gt; 11  6   12  51.33952</span></span>
<span><span class="co">#&gt; 12  6   24  66.40563</span></span>
<span><span class="co">#&gt; 13  7   12  71.35170</span></span>
<span><span class="co">#&gt; 14  7   24  95.19523</span></span>
<span><span class="co">#&gt; 15  8   12  57.10391</span></span>
<span><span class="co">#&gt; 16  8   24  81.70183</span></span>
<span><span class="co">#&gt; 17  9   12  51.23582</span></span>
<span><span class="co">#&gt; 18  9   24  67.72999</span></span>
<span><span class="co">#&gt; 19 10   12  45.90700</span></span>
<span><span class="co">#&gt; 20 10   24  61.53054</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Fidler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
